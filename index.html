<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <title>Experiencia AR F1</title>
        
        <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>

        <style>
            body { 
                margin: 0; 
                overflow: hidden; 
                font-family: sans-serif;
                background-color: #000; /* Fondo negro por si falla la cámara */
            }
            
            /* PANTALLA DE INICIO SIMPLIFICADA */
            #splash-screen {
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(255, 255, 255, 0.95);
                z-index: 9999;
                display: flex; 
                justify-content: center; 
                align-items: center;
                flex-direction: column;
                transition: opacity 0.5s;
            }
            
            #start-button {
                padding: 15px 40px;
                font-size: 18px;
                background: #ff0000; /* Rojo Ferrari */
                color: white;
                border: none;
                border-radius: 30px;
                font-weight: bold;
                cursor: pointer;
                box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            }

            .hidden {
                opacity: 0;
                pointer-events: none;
            }
        </style>

        <script>
            AFRAME.registerComponent('master-controller', {
                init: function () {
                    const btn = document.querySelector("#start-button");
                    const splash = document.querySelector("#splash-screen");
                    const hud = document.querySelector("#hud-container");
                    const vid = document.querySelector("#vid");
                    const model = document.querySelector("#animatedModel");

                    btn.addEventListener('click', () => {
                        // 1. Ocultar pantalla de carga
                        splash.classList.add('hidden');
                        
                        // 2. Mostrar la escena
                        hud.setAttribute('visible', 'true');

                        // 3. Reproducir video (con manejo de errores)
                        vid.muted = true; // NECESARIO para autoplay en muchos móviles
                        var playPromise = vid.play();
                        
                        if (playPromise !== undefined) {
                            playPromise.then(_ => {
                                console.log("Video reproduciendo...");
                                // Opcional: desilenciar después de un segundo si el navegador deja
                                // vid.muted = false; 
                            })
                            .catch(error => {
                                console.log("Error al reproducir video: ", error);
                            });
                        }

                        // 4. Iniciar animación del modelo si existe
                        if (model) {
                            model.setAttribute('animation-mixer', 'timeScale: 1');
                        }
                    });
                }
            });
        </script>
    </head>

    <body>
        <div id="splash-screen">
            <h2 style="margin-bottom:20px; color:#333;">AR EXPERIENCE</h2>
            <button id="start-button">INICIAR EXPERIENCIA</button>
        </div>

        <a-scene
            master-controller
            vr-mode-ui="enabled: false"
            renderer="logarithmicDepthBuffer: true; colorManagement: true;"
            arjs='sourceType: webcam; debugUIEnabled: false;'
            gltf-model="dracoDecoderPath: https://www.gstatic.com/draco/versioned/decoders/1.5.6/;"
            embedded
        >
            <a-assets>
                <video id="vid" src="senna.mp4" preload="auto" loop muted playsinline webkit-playsinline></video>
                <a-asset-item id="miModelo" src="IMOLAF-v1.glb"></a-asset-item>
            </a-assets>

            <a-entity light="type: ambient; intensity: 0.7; color: #ffffff"></a-entity>
            <a-entity light="type: directional; intensity: 1.2; position: 2 4 4"></a-entity>

            <a-entity camera>
                <a-entity id="hud-container" visible="false" position="0 0 -5">
                    
                    <a-video
                        src="#vid"
                        width="3.2" height="1.8"
                        position="0 1.5 -2" 
                    ></a-video>

                    <a-box color="blue" position="0.8 -0.5 0" scale="0.5 0.5 0.5" animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"></a-box>

                    <a-entity
                        id="animatedModel"
                        gltf-model="#miModelo"
                        scale="1 1 1" 
                        position="-0.5 -1 0" 
                        rotation="0 45 0"
                    ></a-entity>

                </a-entity>
            </a-entity>
        </a-scene>
    </body>
</html>
